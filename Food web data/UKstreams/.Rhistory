nodes$efficiencies[nodes$species_type=="detritus"] <- exp(-1.670)*exp(0.164*temp.kT) / (1 + exp(-1.670)*exp(0.164*temp.kT))
# select columns of interest
nodes.sub <- nodes[,c(14:25)]
links <- tlps[,c(1:3)]
webs <- unique(nodes$FW_name)
for (i in 1:length(webs)){
s.nodes <- nodes.sub[nodes.sub$FW_name == webs[i],]
s.links <- links[links$community == webs[i],]
# create link matrix here
source("list.to.matrix.r")
s.links <- s.links[,c(3:2)]
s.links.mat <- List.to.matrix(s.links)
B.matrix <- s.links.mat * s.nodes$biomass
missing.plants <- s.nodes$species_type=="plant" & is.na(s.nodes$biomass)
B.matrix[missing.plants,] <- rep(colSums(B.matrix[s.nodes$species_type=="plant",], na.rm=T), each=sum(missing.plants))
missing.detritus <- s.nodes$species_type=="detritus"
B.matrix[missing.detritus,] <- rep(colSums(B.matrix[s.nodes$species_type=="plant",]) / sum(missing.detritus), each=sum(missing.detritus))
B.matrix[s.links.mat!=0 & B.matrix==0] <- 1
# path of output folder
data.path <- "~/OneDrive - University of Roehampton/Research/Collaborations/FuSED group/fluxwebs/"
#nodes
write.csv(s.nodes,  paste(data.path, 'UKstreams_spAttributes_', webs[i], '.csv', sep = ''), row.names=F)
#links
write.csv(B.matrix,  paste(data.path, 'UKstreams_matrix_', webs[i], '.csv', sep = ''), row.names=F)
print(i)
Sys.sleep(0.1)
}
rm(list=ls())
setwd ("~/OneDrive - University of Roehampton/Research/Collaborations/FuSED group/fluxwebs")
library(igraph)
library(fluxweb)
source("~/OneDrive - University of Roehampton/Research/Collaborations/FuSED group/Food_web_functions.r")
## Fluxweb analysis
meta <- read.csv("UKstream_metadata.csv")
perday <- 60*60*24
web <- unique(meta$FW_name)
for(i in 1:length(web)){
#matrix <- bin.matrix <- as.matrix(read.csv(paste("Icelandic Streams/IcelandicStreams_matrix_",web[i],".csv",sep=""),header=T))
matrix <- bin.matrix <- as.matrix(read.csv(paste("UKstreams_matrix_",web[i],".csv",sep=""),header=T))
diag(matrix) <- 0   ## MAke sure there are no cannibalistic links
bin.matrix[bin.matrix>0] <- 1
igraph <- graph_from_adjacency_matrix(bin.matrix, mode="directed")
#attributes <- read.csv(paste("Icelandic Streams/IcelandicStreams_spAttributes_",web[i],".csv",sep=""))
attributes <- read.csv(paste("UKstreams_spAttributes_",web[i],".csv",sep=""))
attributes$losses[is.na(attributes$losses)] <- 0
## Calculating fluxes
flux <- fluxing(mat=matrix, losses=attributes$losses, efficiencies=attributes$efficiencies, bioms.losses=F, bioms.prefs = F) * perday
meta$flux[i] <- sum(flux)
meta$animal.flux[i] <- sum(flux[attributes$species_type=="animal",])
meta$plant.flux[i] <- sum(flux[attributes$species_type=="plant",])
meta$detritus.flux[i] <- sum(flux[attributes$species_type=="detritus",])
meta$ratio.flux[i] <- meta$animal.flux[i] / sum(meta$plant.flux[i] + meta$detritus.flux[i])
## Biomass distributions
meta$biomass[i] <- sum(attributes$biomass, na.rm=T)
meta$animal.biomass[i] <- sum(attributes$biomass[attributes$species_type=="animal"], na.rm=T)
meta$plant.biomass[i] <- sum(attributes$biomass[attributes$species_type=="plant"], na.rm=T)
#meta$detritus.biomass[i] <- sum(attributes$biomass[attributes$species_type=="detritus"], na.rm=T)
meta$ratio.biomass[i] <- meta$animal.biomass[i] / meta$plant.biomass[i]
meta$MNslope[i] <- coef(lm(log10(attributes$abundance) ~ log10(attributes$bodymass)))[2]
## Food web metrics
meta$S[i] <- Number.of.species(matrix)
meta$L[i] <- Number.of.links(matrix)
meta$LD[i] <- Link.density(matrix)
meta$C[i] <- Connectance(matrix)
meta$B[i] <- Bottom.Intermediate.Top(matrix)$Proportions.of.each[1]
meta$I[i] <- Bottom.Intermediate.Top(matrix)$Proportions.of.each[2]
meta$T[i] <- Bottom.Intermediate.Top(matrix)$Proportions.of.each[3]
meta$generality[i] <- Gen.sd(matrix)
meta$vulnerability[i] <- Vul.sd(matrix)
meta$MeanTL[i] <- mean(TL(bin.matrix))
meta$MaxTL[i] <- max(TL(bin.matrix))
meta$modularity[i] <- cluster_spinglass(igraph)$modularity
}
rm(list=ls())
setwd ("~/OneDrive - University of Roehampton/Research/Collaborations/FuSED group/fluxwebs")
library(igraph)
library(fluxweb)
source("~/OneDrive - University of Roehampton/Research/Collaborations/FuSED group/Food_web_functions.r")
## Fluxweb analysis
meta <- read.csv("UKstream_metadata.csv")
meta <- subset(meta, FW_name != "Bere Stream" & FW_name != "Tadnoll Brook" & FW_name !="Coneyglen Burn")
perday <- 60*60*24
web <- unique(meta$FW_name)
for(i in 1:length(web)){
#matrix <- bin.matrix <- as.matrix(read.csv(paste("Icelandic Streams/IcelandicStreams_matrix_",web[i],".csv",sep=""),header=T))
matrix <- bin.matrix <- as.matrix(read.csv(paste("UKstreams_matrix_",web[i],".csv",sep=""),header=T))
diag(matrix) <- 0   ## MAke sure there are no cannibalistic links
bin.matrix[bin.matrix>0] <- 1
igraph <- graph_from_adjacency_matrix(bin.matrix, mode="directed")
#attributes <- read.csv(paste("Icelandic Streams/IcelandicStreams_spAttributes_",web[i],".csv",sep=""))
attributes <- read.csv(paste("UKstreams_spAttributes_",web[i],".csv",sep=""))
attributes$losses[is.na(attributes$losses)] <- 0
## Calculating fluxes
flux <- fluxing(mat=matrix, losses=attributes$losses, efficiencies=attributes$efficiencies, bioms.losses=F, bioms.prefs = F) * perday
meta$flux[i] <- sum(flux)
meta$animal.flux[i] <- sum(flux[attributes$species_type=="animal",])
meta$plant.flux[i] <- sum(flux[attributes$species_type=="plant",])
meta$detritus.flux[i] <- sum(flux[attributes$species_type=="detritus",])
meta$ratio.flux[i] <- meta$animal.flux[i] / sum(meta$plant.flux[i] + meta$detritus.flux[i])
## Biomass distributions
meta$biomass[i] <- sum(attributes$biomass, na.rm=T)
meta$animal.biomass[i] <- sum(attributes$biomass[attributes$species_type=="animal"], na.rm=T)
meta$plant.biomass[i] <- sum(attributes$biomass[attributes$species_type=="plant"], na.rm=T)
#meta$detritus.biomass[i] <- sum(attributes$biomass[attributes$species_type=="detritus"], na.rm=T)
meta$ratio.biomass[i] <- meta$animal.biomass[i] / meta$plant.biomass[i]
meta$MNslope[i] <- coef(lm(log10(attributes$abundance) ~ log10(attributes$bodymass)))[2]
## Food web metrics
meta$S[i] <- Number.of.species(matrix)
meta$L[i] <- Number.of.links(matrix)
meta$LD[i] <- Link.density(matrix)
meta$C[i] <- Connectance(matrix)
meta$B[i] <- Bottom.Intermediate.Top(matrix)$Proportions.of.each[1]
meta$I[i] <- Bottom.Intermediate.Top(matrix)$Proportions.of.each[2]
meta$T[i] <- Bottom.Intermediate.Top(matrix)$Proportions.of.each[3]
meta$generality[i] <- Gen.sd(matrix)
meta$vulnerability[i] <- Vul.sd(matrix)
meta$MeanTL[i] <- mean(TL(bin.matrix))
meta$MaxTL[i] <- max(TL(bin.matrix))
meta$modularity[i] <- cluster_spinglass(igraph)$modularity
}
plot(log10(meta$flux) ~ meta$temperature)
plot(log10(meta$ratio.flux) ~ meta$temperature)
plot(log10(meta$flux) ~ meta$biomass)
plot(log10(meta$flux) ~ log10(meta$biomass))
plot(log10(meta$ratio.flux) ~ meta$biomass)
plot(log10(meta$ratio.flux) ~ log10(meta$biomass))
plot(log10(meta$animal.flux) ~ log10(meta$biomass))
plot(log10(meta$plant.flux) ~ log10(meta$biomass))
plot(log10(meta$flux) ~ meta$S)
plot(log10(meta$ratio.flux) ~ meta$S)
plot(log10(meta$animal.flux) ~ meta$S)
plot(log10(meta$plant.flux) ~ meta$S)
plot(log10(meta$ratio.flux) ~ meta$S)
plot(log10(meta$flux) ~ meta$C)
head(meta)
meta$C
meta <- meta[order(meta$flux),]
head(meta)
matrix
bin.matrix
rm(list=ls())
setwd ("~/OneDrive - University of Roehampton/Research/Collaborations/FuSED group/fluxwebs")
library(igraph)
library(fluxweb)
source("~/OneDrive - University of Roehampton/Research/Collaborations/FuSED group/Food_web_functions.r")
## Fluxweb analysis
meta <- read.csv("UKstream_metadata.csv")
meta <- subset(meta, FW_name != "Bere Stream" & FW_name != "Tadnoll Brook" & FW_name !="Coneyglen Burn")
perday <- 60*60*24
web <- unique(meta$FW_name)
for(i in 1:length(web)){
#matrix <- bin.matrix <- as.matrix(read.csv(paste("Icelandic Streams/IcelandicStreams_matrix_",web[i],".csv",sep=""),header=T))
matrix <- bin.matrix <- as.matrix(read.csv(paste("UKstreams_matrix_",web[i],".csv",sep=""),header=T))
diag(matrix) <- 0   ## MAke sure there are no cannibalistic links
bin.matrix[bin.matrix>0] <- 1
igraph <- graph_from_adjacency_matrix(bin.matrix, mode="directed")
#attributes <- read.csv(paste("Icelandic Streams/IcelandicStreams_spAttributes_",web[i],".csv",sep=""))
attributes <- read.csv(paste("UKstreams_spAttributes_",web[i],".csv",sep=""))
attributes$losses[is.na(attributes$losses)] <- 0
## Calculating fluxes
flux <- fluxing(mat=matrix, losses=attributes$losses, efficiencies=attributes$efficiencies, bioms.losses=F, bioms.prefs = F) * perday
meta$flux[i] <- sum(flux)
meta$animal.flux[i] <- sum(flux[attributes$species_type=="animal",])
meta$plant.flux[i] <- sum(flux[attributes$species_type=="plant",])
meta$detritus.flux[i] <- sum(flux[attributes$species_type=="detritus",])
meta$ratio.flux[i] <- meta$animal.flux[i] / sum(meta$plant.flux[i] + meta$detritus.flux[i])
## Biomass distributions
meta$biomass[i] <- sum(attributes$biomass, na.rm=T)
meta$animal.biomass[i] <- sum(attributes$biomass[attributes$species_type=="animal"], na.rm=T)
meta$plant.biomass[i] <- sum(attributes$biomass[attributes$species_type=="plant"], na.rm=T)
#meta$detritus.biomass[i] <- sum(attributes$biomass[attributes$species_type=="detritus"], na.rm=T)
meta$ratio.biomass[i] <- meta$animal.biomass[i] / meta$plant.biomass[i]
meta$MNslope[i] <- coef(lm(log10(attributes$abundance) ~ log10(attributes$bodymass)))[2]
## Food web metrics
meta$S[i] <- Number.of.species(bin.matrix)
meta$L[i] <- Number.of.links(bin.matrix)
meta$LD[i] <- Link.density(bin.matrix)
meta$C[i] <- Connectance(bin.matrix)
meta$B[i] <- Bottom.Intermediate.Top(bin.matrix)$Proportions.of.each[1]
meta$I[i] <- Bottom.Intermediate.Top(bin.matrix)$Proportions.of.each[2]
meta$T[i] <- Bottom.Intermediate.Top(bin.matrix)$Proportions.of.each[3]
meta$generality[i] <- Gen.sd(bin.matrix)
meta$vulnerability[i] <- Vul.sd(bin.matrix)
meta$MeanTL[i] <- mean(TL(bin.bin.matrix))
meta$MaxTL[i] <- max(TL(bin.bin.matrix))
meta$modularity[i] <- cluster_spinglass(igraph)$modularity
}
## Relationships between flux and temperature
plot(log10(meta$flux) ~ meta$temperature)
plot(log10(meta$ratio.flux) ~ meta$temperature)
plot(log10(meta$animal.flux) ~ meta$temperature)
plot(log10(meta$plant.flux) ~ meta$temperature)
## Relationships between flux and biomass
plot(log10(meta$flux) ~ log10(meta$biomass))
plot(log10(meta$ratio.flux) ~ log10(meta$biomass))
plot(log10(meta$animal.flux) ~ log10(meta$biomass))
plot(log10(meta$plant.flux) ~ log10(meta$biomass))
plot(log10(meta$flux) ~ meta$biomass)
plot(log10(meta$ratio.flux) ~ log10(meta$biomass))
head(meta)
rm(list=ls())
setwd ("~/OneDrive - University of Roehampton/Research/Collaborations/FuSED group/fluxwebs")
library(igraph)
library(fluxweb)
source("~/OneDrive - University of Roehampton/Research/Collaborations/FuSED group/Food_web_functions.r")
## Fluxweb analysis
meta <- read.csv("UKstream_metadata.csv")
meta <- subset(meta, FW_name != "Bere Stream" & FW_name != "Tadnoll Brook" & FW_name !="Coneyglen Burn")
perday <- 60*60*24
web <- unique(meta$FW_name)
for(i in 1:length(web)){
#matrix <- bin.matrix <- as.matrix(read.csv(paste("Icelandic Streams/IcelandicStreams_matrix_",web[i],".csv",sep=""),header=T))
matrix <- bin.matrix <- as.matrix(read.csv(paste("UKstreams_matrix_",web[i],".csv",sep=""),header=T))
diag(matrix) <- 0   ## MAke sure there are no cannibalistic links
bin.matrix[bin.matrix>0] <- 1
igraph <- graph_from_adjacency_matrix(bin.matrix, mode="directed")
#attributes <- read.csv(paste("Icelandic Streams/IcelandicStreams_spAttributes_",web[i],".csv",sep=""))
attributes <- read.csv(paste("UKstreams_spAttributes_",web[i],".csv",sep=""))
attributes$losses[is.na(attributes$losses)] <- 0
## Calculating fluxes
flux <- fluxing(mat=matrix, losses=attributes$losses, efficiencies=attributes$efficiencies, bioms.losses=F, bioms.prefs = F) * perday
meta$flux[i] <- sum(flux)
meta$animal.flux[i] <- sum(flux[attributes$species_type=="animal",])
meta$plant.flux[i] <- sum(flux[attributes$species_type=="plant",])
meta$detritus.flux[i] <- sum(flux[attributes$species_type=="detritus",])
meta$ratio.flux[i] <- meta$animal.flux[i] / sum(meta$plant.flux[i] + meta$detritus.flux[i])
## Biomass distributions
meta$biomass[i] <- sum(attributes$biomass, na.rm=T)
meta$animal.biomass[i] <- sum(attributes$biomass[attributes$species_type=="animal"], na.rm=T)
meta$plant.biomass[i] <- sum(attributes$biomass[attributes$species_type=="plant"], na.rm=T)
#meta$detritus.biomass[i] <- sum(attributes$biomass[attributes$species_type=="detritus"], na.rm=T)
meta$ratio.biomass[i] <- meta$animal.biomass[i] / meta$plant.biomass[i]
meta$MNslope[i] <- coef(lm(log10(attributes$abundance) ~ log10(attributes$bodymass)))[2]
## Food web metrics
meta$S[i] <- Number.of.species(bin.matrix)
meta$L[i] <- Number.of.links(bin.matrix)
meta$LD[i] <- Link.density(bin.matrix)
meta$C[i] <- Connectance(bin.matrix)
meta$B[i] <- Bottom.Intermediate.Top(bin.matrix)$Proportions.of.each[1]
meta$I[i] <- Bottom.Intermediate.Top(bin.matrix)$Proportions.of.each[2]
meta$T[i] <- Bottom.Intermediate.Top(bin.matrix)$Proportions.of.each[3]
meta$generality[i] <- Gen.sd(bin.matrix)
meta$vulnerability[i] <- Vul.sd(bin.matrix)
meta$MeanTL[i] <- mean(TL(bin.bin.matrix))
meta$MaxTL[i] <- max(TL(bin.bin.matrix))
meta$modularity[i] <- cluster_spinglass(igraph)$modularity
}
## Relationships between flux and temperature
plot(log10(meta$flux) ~ meta$temperature)
plot(log10(meta$ratio.flux) ~ meta$temperature)
plot(log10(meta$animal.flux) ~ meta$temperature)
plot(log10(meta$plant.flux) ~ meta$temperature)
## Relationships between flux and biomass
plot(log10(meta$flux) ~ meta$biomass)
rm(list=ls())
setwd ("~/OneDrive - University of Roehampton/Research/Collaborations/FuSED group/fluxwebs")
library(igraph)
library(fluxweb)
source("~/OneDrive - University of Roehampton/Research/Collaborations/FuSED group/Food_web_functions.r")
## Fluxweb analysis
meta <- read.csv("UKstream_metadata.csv")
meta <- subset(meta, FW_name != "Bere Stream" & FW_name != "Tadnoll Brook" & FW_name !="Coneyglen Burn")
perday <- 60*60*24
web <- unique(meta$FW_name)
for(i in 1:length(web)){
#matrix <- bin.matrix <- as.matrix(read.csv(paste("Icelandic Streams/IcelandicStreams_matrix_",web[i],".csv",sep=""),header=T))
matrix <- bin.matrix <- as.matrix(read.csv(paste("UKstreams_matrix_",web[i],".csv",sep=""),header=T))
diag(matrix) <- 0   ## MAke sure there are no cannibalistic links
bin.matrix[bin.matrix>0] <- 1
igraph <- graph_from_adjacency_matrix(bin.matrix, mode="directed")
#attributes <- read.csv(paste("Icelandic Streams/IcelandicStreams_spAttributes_",web[i],".csv",sep=""))
attributes <- read.csv(paste("UKstreams_spAttributes_",web[i],".csv",sep=""))
attributes$losses[is.na(attributes$losses)] <- 0
## Calculating fluxes
flux <- fluxing(mat=matrix, losses=attributes$losses, efficiencies=attributes$efficiencies, bioms.losses=F, bioms.prefs = F) * perday
meta$flux[i] <- sum(flux)
meta$animal.flux[i] <- sum(flux[attributes$species_type=="animal",])
meta$plant.flux[i] <- sum(flux[attributes$species_type=="plant",])
meta$detritus.flux[i] <- sum(flux[attributes$species_type=="detritus",])
meta$ratio.flux[i] <- meta$animal.flux[i] / sum(meta$plant.flux[i] + meta$detritus.flux[i])
## Biomass distributions
meta$biomass[i] <- sum(attributes$biomass, na.rm=T)
meta$animal.biomass[i] <- sum(attributes$biomass[attributes$species_type=="animal"], na.rm=T)
meta$plant.biomass[i] <- sum(attributes$biomass[attributes$species_type=="plant"], na.rm=T)
#meta$detritus.biomass[i] <- sum(attributes$biomass[attributes$species_type=="detritus"], na.rm=T)
meta$ratio.biomass[i] <- meta$animal.biomass[i] / meta$plant.biomass[i]
meta$MNslope[i] <- coef(lm(log10(attributes$abundance) ~ log10(attributes$bodymass)))[2]
## Food web metrics
meta$S[i] <- Number.of.species(bin.matrix)
meta$L[i] <- Number.of.links(bin.matrix)
meta$LD[i] <- Link.density(bin.matrix)
meta$C[i] <- Connectance(bin.matrix)
meta$B[i] <- Bottom.Intermediate.Top(bin.matrix)$Proportions.of.each[1]
meta$I[i] <- Bottom.Intermediate.Top(bin.matrix)$Proportions.of.each[2]
meta$T[i] <- Bottom.Intermediate.Top(bin.matrix)$Proportions.of.each[3]
meta$generality[i] <- Gen.sd(bin.matrix)
meta$vulnerability[i] <- Vul.sd(bin.matrix)
meta$MeanTL[i] <- mean(TL(bin.matrix))
meta$MaxTL[i] <- max(TL(bin.matrix))
meta$modularity[i] <- cluster_spinglass(igraph)$modularity
}
## Relationships between flux and temperature
plot(log10(meta$flux) ~ meta$temperature)
plot(log10(meta$ratio.flux) ~ meta$temperature)
plot(log10(meta$animal.flux) ~ meta$temperature)
plot(log10(meta$plant.flux) ~ meta$temperature)
## Relationships between flux and biomass
plot(log10(meta$flux) ~ meta$biomass)
plot(log10(meta$flux) ~ log10(meta$biomass))
head(meta)
meta$C
meta$biomass
meta[26,]
plot(log10(meta$ratio.flux) ~ log10(meta$biomass))
plot(log10(meta$flux) ~ log10(meta$biomass))
plot(log10(meta$ratio.flux) ~ log10(meta$biomass))
plot(log10(meta$animal.flux) ~ log10(meta$biomass))
plot(log10(meta$plant.flux) ~ log10(meta$biomass))
plot(log10(meta$flux) ~ meta$S)
plot(log10(meta$ratio.flux) ~ meta$S)
plot(log10(meta$animal.flux) ~ meta$S)
plot(log10(meta$plant.flux) ~ meta$S)
plot(log10(meta$flux) ~ meta$S)
plot(log10(meta$flux) ~ meta$C)
plot(log10(meta$ratio.flux) ~ meta$C)
plot(log10(meta$animal.flux) ~ meta$C)
plot(log10(meta$plant.flux) ~ meta$C)
plot(log10(meta$flux) ~ meta$MeanTL)
plot(log10(meta$ratio.flux) ~ meta$MeanTL)
plot(log10(meta$animal.flux) ~ meta$MeanTL)
plot(log10(meta$plant.flux) ~ meta$MeanTL)
plot(log10(meta$flux) ~ meta$MaxTL)
plot(log10(meta$ratio.flux) ~ meta$MaxTL)
plot(log10(meta$animal.flux) ~ meta$MaxTL)
plot(log10(meta$plant.flux) ~ meta$MaxTL)
plot(log10(meta$flux) ~ meta$modularity)
plot(log10(meta$ratio.flux) ~ meta$modularity)
plot(log10(meta$animal.flux) ~ meta$modularity)
plot(log10(meta$animal.flux) ~ meta$modularity)
plot(log10(meta$animal.flux) ~ meta$modularity)
plot(log10(meta$ratio.flux) ~ meta$modularity)
plot(log10(meta$flux) ~ log10(meta$biomass))
plot(log10(meta$ratio.flux) ~ log10(meta$biomass))
plot(log10(meta$animal.flux) ~ log10(meta$biomass))
plot(log10(meta$plant.flux) ~ log10(meta$biomass))
plot(log10(meta$flux) ~ meta$temperature)
plot(log10(meta$flux) ~ log10(meta$biomass))
plot(log10(meta$ratio.flux) ~ log10(meta$biomass))
plot(log10(meta$flux) ~ log10(meta$biomass))
head(meta)
rm(list=ls())
setwd ("~/OneDrive - University of Roehampton/Research/Collaborations/FuSED group/fluxwebs")
library(igraph)
library(fluxweb)
source("~/OneDrive - University of Roehampton/Research/Collaborations/FuSED group/Food_web_functions.r")
## Fluxweb analysis
meta <- read.csv("UKstream_metadata.csv")
meta <- subset(meta, FW_name != "Bere Stream" & FW_name != "Tadnoll Brook" & FW_name !="Coneyglen Burn")
meta <- subset(meta, fish != "FALSE")
perday <- 60*60*24
web <- unique(meta$FW_name)
for(i in 1:length(web)){
#matrix <- bin.matrix <- as.matrix(read.csv(paste("Icelandic Streams/IcelandicStreams_matrix_",web[i],".csv",sep=""),header=T))
matrix <- bin.matrix <- as.matrix(read.csv(paste("UKstreams_matrix_",web[i],".csv",sep=""),header=T))
diag(matrix) <- 0   ## MAke sure there are no cannibalistic links
bin.matrix[bin.matrix>0] <- 1
igraph <- graph_from_adjacency_matrix(bin.matrix, mode="directed")
#attributes <- read.csv(paste("Icelandic Streams/IcelandicStreams_spAttributes_",web[i],".csv",sep=""))
attributes <- read.csv(paste("UKstreams_spAttributes_",web[i],".csv",sep=""))
attributes$losses[is.na(attributes$losses)] <- 0
## Calculating fluxes
flux <- fluxing(mat=matrix, losses=attributes$losses, efficiencies=attributes$efficiencies, bioms.losses=F, bioms.prefs = F) * perday
meta$flux[i] <- sum(flux)
meta$animal.flux[i] <- sum(flux[attributes$species_type=="animal",])
meta$plant.flux[i] <- sum(flux[attributes$species_type=="plant",])
meta$detritus.flux[i] <- sum(flux[attributes$species_type=="detritus",])
meta$ratio.flux[i] <- meta$animal.flux[i] / sum(meta$plant.flux[i] + meta$detritus.flux[i])
## Biomass distributions
meta$biomass[i] <- sum(attributes$biomass, na.rm=T)
meta$animal.biomass[i] <- sum(attributes$biomass[attributes$species_type=="animal"], na.rm=T)
meta$plant.biomass[i] <- sum(attributes$biomass[attributes$species_type=="plant"], na.rm=T)
#meta$detritus.biomass[i] <- sum(attributes$biomass[attributes$species_type=="detritus"], na.rm=T)
meta$ratio.biomass[i] <- meta$animal.biomass[i] / meta$plant.biomass[i]
meta$MNslope[i] <- coef(lm(log10(attributes$abundance) ~ log10(attributes$bodymass)))[2]
## Food web metrics
meta$S[i] <- Number.of.species(bin.matrix)
meta$L[i] <- Number.of.links(bin.matrix)
meta$LD[i] <- Link.density(bin.matrix)
meta$C[i] <- Connectance(bin.matrix)
meta$B[i] <- Bottom.Intermediate.Top(bin.matrix)$Proportions.of.each[1]
meta$I[i] <- Bottom.Intermediate.Top(bin.matrix)$Proportions.of.each[2]
meta$T[i] <- Bottom.Intermediate.Top(bin.matrix)$Proportions.of.each[3]
meta$generality[i] <- Gen.sd(bin.matrix)
meta$vulnerability[i] <- Vul.sd(bin.matrix)
meta$MeanTL[i] <- mean(TL(bin.matrix))
meta$MaxTL[i] <- max(TL(bin.matrix))
meta$modularity[i] <- cluster_spinglass(igraph)$modularity
}
## Relationships between flux and temperature
plot(log10(meta$flux) ~ meta$temperature)
plot(log10(meta$ratio.flux) ~ meta$temperature)
plot(log10(meta$animal.flux) ~ meta$temperature)
plot(log10(meta$plant.flux) ~ meta$temperature)
## Relationships between flux and biomass
plot(log10(meta$flux) ~ log10(meta$biomass))
plot(log10(meta$ratio.flux) ~ log10(meta$biomass))
plot(log10(meta$animal.flux) ~ log10(meta$biomass))
plot(log10(meta$plant.flux) ~ log10(meta$biomass))
plot(log10(meta$flux) ~ log10(meta$biomass))
plot(log10(meta$ratio.flux) ~ log10(meta$biomass))
plot(log10(meta$animal.flux) ~ log10(meta$biomass))
plot(log10(meta$plant.flux) ~ log10(meta$biomass))
plot(log10(meta$flux) ~ meta$S)
plot(log10(meta$ratio.flux) ~ meta$S)
plot(log10(meta$flux) ~ meta$S)
plot(log10(meta$plant.flux) ~ meta$S)
plot(log10(meta$plant.flux) ~ log10(meta$biomass))
plot(log10(meta$flux) ~ log10(meta$biomass))
rm(list=ls())
setwd ("~/OneDrive - University of Roehampton/Research/Collaborations/FuSED group/fluxwebs")
library(igraph)
library(fluxweb)
source("~/OneDrive - University of Roehampton/Research/Collaborations/FuSED group/Food_web_functions.r")
## Fluxweb analysis
meta <- read.csv("UKstream_metadata.csv")
meta <- subset(meta, FW_name != "Bere Stream" & FW_name != "Tadnoll Brook" & FW_name !="Coneyglen Burn")
#meta <- subset(meta, fish != "FALSE")
perday <- 60*60*24
web <- unique(meta$FW_name)
for(i in 1:length(web)){
#matrix <- bin.matrix <- as.matrix(read.csv(paste("Icelandic Streams/IcelandicStreams_matrix_",web[i],".csv",sep=""),header=T))
matrix <- bin.matrix <- as.matrix(read.csv(paste("UKstreams_matrix_",web[i],".csv",sep=""),header=T))
diag(matrix) <- 0   ## MAke sure there are no cannibalistic links
bin.matrix[bin.matrix>0] <- 1
igraph <- graph_from_adjacency_matrix(bin.matrix, mode="directed")
#attributes <- read.csv(paste("Icelandic Streams/IcelandicStreams_spAttributes_",web[i],".csv",sep=""))
attributes <- read.csv(paste("UKstreams_spAttributes_",web[i],".csv",sep=""))
attributes$losses[is.na(attributes$losses)] <- 0
## Calculating fluxes
flux <- fluxing(mat=matrix, losses=attributes$losses, efficiencies=attributes$efficiencies, bioms.losses=F, bioms.prefs = F) * perday
meta$flux[i] <- sum(flux)
meta$animal.flux[i] <- sum(flux[attributes$species_type=="animal",])
meta$plant.flux[i] <- sum(flux[attributes$species_type=="plant",])
meta$detritus.flux[i] <- sum(flux[attributes$species_type=="detritus",])
meta$ratio.flux[i] <- meta$animal.flux[i] / sum(meta$plant.flux[i] + meta$detritus.flux[i])
## Biomass distributions
meta$biomass[i] <- sum(attributes$biomass, na.rm=T)
meta$animal.biomass[i] <- sum(attributes$biomass[attributes$species_type=="animal"], na.rm=T)
meta$plant.biomass[i] <- sum(attributes$biomass[attributes$species_type=="plant"], na.rm=T)
#meta$detritus.biomass[i] <- sum(attributes$biomass[attributes$species_type=="detritus"], na.rm=T)
meta$ratio.biomass[i] <- meta$animal.biomass[i] / meta$plant.biomass[i]
meta$MNslope[i] <- coef(lm(log10(attributes$abundance) ~ log10(attributes$bodymass)))[2]
## Food web metrics
meta$S[i] <- Number.of.species(bin.matrix)
meta$L[i] <- Number.of.links(bin.matrix)
meta$LD[i] <- Link.density(bin.matrix)
meta$C[i] <- Connectance(bin.matrix)
meta$B[i] <- Bottom.Intermediate.Top(bin.matrix)$Proportions.of.each[1]
meta$I[i] <- Bottom.Intermediate.Top(bin.matrix)$Proportions.of.each[2]
meta$T[i] <- Bottom.Intermediate.Top(bin.matrix)$Proportions.of.each[3]
meta$generality[i] <- Gen.sd(bin.matrix)
meta$vulnerability[i] <- Vul.sd(bin.matrix)
meta$MeanTL[i] <- mean(TL(bin.matrix))
meta$MaxTL[i] <- max(TL(bin.matrix))
meta$modularity[i] <- cluster_spinglass(igraph)$modularity
}
## Relationships between flux and temperature
plot(log10(meta$flux) ~ meta$temperature)
plot(log10(meta$ratio.flux) ~ meta$temperature)
plot(log10(meta$animal.flux) ~ meta$temperature)
plot(log10(meta$plant.flux) ~ meta$temperature)
plot(meta$S ~ log10(meta$biomass))
plot(log10(meta$flux) ~ meta$B)
plot(log10(meta$flux) ~ meta$T)
plot(log10(meta$flux) ~ meta$I)
head(meta)
plot(log10(meta$flux) ~ log10(meta$biomass))
plot(log10(meta$flux) ~ meta$S)
plot(log10(meta$flux) ~ meta$C)
plot(log10(meta$ratio.flux) ~ meta$S)
plot(log10(meta$ratio.flux) ~ meta$S)
plot(log10(meta$animal.flux) ~ meta$S)
plot(log10(meta$plant.flux) ~ meta$S)
plot(log10(meta$flux) ~ meta$modularity)
plot(log10(meta$flux) ~ log10(meta$biomass))
plot(log10(meta$ratio.flux) ~ log10(meta$biomass))
plot(log10(meta$animal.flux) ~ log10(meta$biomass))
plot(log10(meta$plant.flux) ~ log10(meta$biomass))
plot(log10(meta$flux) ~ meta$S)
plot(log10(meta$ratio.flux) ~ meta$S)
plot(log10(meta$animal.flux) ~ meta$S)
plot(log10(meta$plant.flux) ~ meta$S)
plot(log10(meta$flux) ~ meta$T)
plot(log10(meta$flux) ~ meta$temperature)
plot(log10(meta$flux) ~ log10(meta$biomass))
plot(log10(meta$ratio.flux) ~ log10(meta$biomass))
plot(log10(meta$animal.flux) ~ log10(meta$biomass))
plot(log10(meta$plant.flux) ~ log10(meta$biomass))
plot(log10(meta$flux) ~ meta$S)
plot(log10(meta$flux) ~ log10(meta$biomass))
plot(log10(meta$flux) ~ meta$S)
plot(log10(meta$ratio.flux) ~ meta$S)
plot(log10(meta$animal.flux) ~ meta$S)
plot(log10(meta$plant.flux) ~ meta$S)
plot(log10(meta$flux) ~ meta$C)
plot(log10(meta$flux) ~ meta$MeanTL)
plot(log10(meta$flux) ~ meta$MaxTL)
plot(log10(meta$flux) ~ meta$modularity)
plot(log10(meta$ratio.flux) ~ meta$modularity)
plot(log10(meta$plant.flux) ~ meta$modularity)
plot(log10(meta$flux) ~ meta$T)
write.csv(meta, 'UKoutput.csv', row.names=F)
